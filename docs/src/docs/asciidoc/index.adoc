= Master Mind. Solución 8.2. *mvp.pm.withDoubleDispatching*
Álvaro Martín Martín <amartinm82@gmail.com>
:toc-title: Índice
:toc: left

:idprefix:
:idseparator: -
:imagesdir: images

== Requisitos 1. *Básica*

[cols="50,50"]
|===

a|
- link:https://en.wikipedia.org/wiki/Mastermind_(board_game)[*Wiki*] - link:https://www.youtube.com/watch?v=2-hTeg2M6GQ[*Youtube*]
* _Funcionalidad: **Básica**_
* _Interfaz: **Texto**_
* _Distribución: **Standalone**_
* _Persistencia: **No**_

a|

image::Dibujo.jpg[]

|===


== Vista de Lógica/Diseño

- Arquitectura Documento/Vista mediante *Patrón de Vista Separada*

=== Arquitectura 

[plantuml,version2Arquitectura,svg]
....

package mastermind #DDDDDD { } 
mastermind .down.> mastermind.controllers
mastermind .down.> mastermind.models
mastermind .down.> mastermind.views

package mastermind.controllers #DDDDDD { }
mastermind.controllers .down.> mastermind.models

package mastermind.models #DDDDDD { } 
package java.util{ }
mastermind.models .down.> java.util

package mastermind.utils #DDDDDD { } 
package java.io{ }
mastermind.utils .down.> java.io

package mastermind.views #DDDDDD {
    package mastermind.views.console {}
    package mastermind.views.graphics {}
}
mastermind.views .down.> mastermind.controllers
mastermind.views.console .down.> mastermind.utils

....

=== Paquete _mastermind_ 

[plantuml,version2Mastermind,svg]

....

abstract class  mastermind.Mastermind{
- final logic: Logic
- final view: View
# Mastermind()
# {abstract} createView(): View
# play(): void
}

class mastermind.ConsoleMastermind extends mastermind.Mastermind{
# createView(): View
+ {static} main(String[] args): void
}

class mastermind.GraphicsMastermind extends mastermind.Mastermind{
# createView(): View
+ {static} main(String[] args): void
}

mastermind.Mastermind *-down-> mastermind.views.View
mastermind.Mastermind *-down-> mastermind.controllers.Logic
mastermind.Mastermind .down.> mastermind.controllers.UseCaseController

mastermind.GraphicsMastermind .down.> mastermind.views.graphics.View

mastermind.ConsoleMastermind .down.> mastermind.views.console.View

mastermind.views.View <|.down.> mastermind.controllers.ControllerVisitor
mastermind.views.View <|-down-> mastermind.views.console.View
mastermind.views.View <|-down-> mastermind.views.graphics.View
....

=== Paquete _mastermind.views_ 

[plantuml,mastermindViews,svg]

....


abstract class mastermind.views.View {
+ {abstract} interact(UseCaseController controller): void
}

mastermind.views.View .up.> mastermind.controllers.UseCaseController

class mastermind.views.graphics.View {
+ interact(UseCaseController controller): void
}

mastermind.views.View <|-left- mastermind.views.graphics.View
mastermind.views.graphics.View .left.> mastermind.controllers.UseCaseController

class mastermind.views.console.View{
- final startView: StartView
- final playView: PlayView
- final resumeView: ResumeView

+ View()
+ interact(UseCaseController controller): void
+ visit(StartController startController): void
+ visit(PlayController playController): void
+ visit(ResumeController resumeController): void
}
mastermind.views.View <|-right- mastermind.views.console.View
mastermind.controllers.ControllerVisitor <|.up. mastermind.views.console.View
mastermind.views.console.View *-down-> mastermind.views.console.StartView
mastermind.views.console.View *-down-> mastermind.views.console.PlayView
mastermind.views.console.View *-down-> mastermind.views.console.ResumeView
mastermind.views.console.View .up.> mastermind.controllers.UseCaseController

enum mastermind.views.console.MessageView{
+ {static} ATTEMPTS: MessageView
+ {static} RESUME: MessageView
+ {static} RESULT: MessageView
+ {static} PROPOSED_COMBINATION: MessageView
+ {static} TITLE: MessageView
+ {static} WINNER: MessageView
+ {static} LOOSER: MessageView

- final message: String
- final console: Console

- MessageView(String message)
write(): void
writeln(): void
writeln(int attempts): void
writeln(int blacks, int whites): void
}

class mastermind.views.console.StartView {
# interact(StartController startController): void
}

mastermind.views.console.StartView .down.> mastermind.controllers.StartController
mastermind.views.console.StartView .up.> mastermind.views.console.MessageView
mastermind.views.console.StartView .down.> mastermind.views.console.SecretCombinationView

class mastermind.views.console.SecretCombinationView extends utils.WithConsoleView {
SecretCombinationView()
writeln(): void
}

mastermind.views.console.SecretCombinationView .down.> mastermind.models.SecretCombination
mastermind.views.console.SecretCombinationView .up.> mastermind.views.console.MessageView

class mastermind.views.console.ResumeView {
interact(ResumeController resumeController): void
}

mastermind.views.console.ResumeView .down.> mastermind.controllers.ResumeController
mastermind.views.console.ResumeView .down.> utils.YesNoDialog
mastermind.views.console.ResumeView .up.> mastermind.views.console.MessageView

class mastermind.views.console.ResultView extends utils.WithConsoleView {
- final result: Result
ResultView(Result result)
writeln(): void
}

mastermind.views.console.ResultView *-down-> mastermind.models.Result
mastermind.views.console.ResultView .up.> mastermind.views.console.MessageView

class mastermind.views.console.ProposedCombinationView extends utils.WithConsoleView {
- final proposedCombination: ProposedCombination
ProposedCombinationView(ProposedCombination proposedCombination)
write(): void
read(): void
}

mastermind.views.console.ProposedCombinationView *-down-> mastermind.models.ProposedCombination
mastermind.views.console.ProposedCombinationView .down.> mastermind.models.Color
mastermind.views.console.ProposedCombinationView .down.> mastermind.views.console.ColorView
mastermind.views.console.ProposedCombinationView .down.> mastermind.models.Error
mastermind.views.console.ProposedCombinationView .up.> mastermind.views.console.MessageView
mastermind.views.console.ProposedCombinationView .down.> mastermind.views.console.ErrorView

class mastermind.views.console.PlayView extends utils.WithConsoleView {
- final secretCombinationView: SecretCombinationView
PlayView()
interact(PlayController playController): void
}

mastermind.views.console.PlayView *-down-> mastermind.views.console.SecretCombinationView
mastermind.views.console.PlayView .down.> mastermind.controllers.PlayController
mastermind.views.console.PlayView .down.> mastermind.models.ProposedCombination
mastermind.views.console.PlayView .down.> mastermind.views.console.ProposedCombinationView
mastermind.views.console.PlayView .up.> mastermind.views.console.MessageView
mastermind.views.console.PlayView .down.> mastermind.views.console.ResultView

mastermind.views.console.MessageView *-down-> utils.Console

class mastermind.views.console.ErrorView extends utils.WithConsoleView{
- {static} final MESSAGES: String[]
- final error: Error
ErrorView(Error error)
writeln(): void
}

mastermind.views.console.ErrorView *-down-> mastermind.models.Error

class mastermind.views.console.ColorView extends utils.WithConsoleView {
- {static} final INITIALS: char[]
- final color: Color
ColorView(Color color)
{static} allInitials(): String
{static} getInstance(char character): Color
write(): void
}

mastermind.views.console.ColorView *-down-> mastermind.models.Color
....

=== Paquete _mastermind.models_ 


[plantuml,paqueteMastermindModel,svg]

....

enum mastermind.models.Color{
+ {static} RED: Color
+ {static} BLUE: Color
+ {static} YELLOW: Color
+ {static} GREEN: Color
+ {static} ORANGE: Color
+ {static} PURPLE: Color
{static} length(): int
}

class  mastermind.models.Game{
- {static} final MAX_LONG: int
- secretCombination: SecretCombination
- proposedCombinations: List<ProposedCombination>
- results: List<Result>
- attempts: int
+ Game()
+ clear(): void
+ addProposedCombination(ProposedCombination proposedCombination): void
+ isLooser(): boolean
+ isWinner(): boolean
+ getAttempts(): int
+ getProposedCombination(int position): ProposedCombination
+ getResult(int position): Result
}
mastermind.models.Game *-down-> mastermind.models.SecretCombination
mastermind.models.Game *-down-> mastermind.models.Result
mastermind.models.Game *-down-> mastermind.models.ProposedCombination

class  mastermind.models.ProposedCombination extends mastermind.models.Combination {
contains(Color color, int position): boolean
contains(Color color): boolean
+ getColors(): List<Color>
}

mastermind.models.ProposedCombination .down.> mastermind.models.Color

class mastermind.models.Result{
- blacks: int
- whites: int
Result(int, int)
isWinner(): boolean
+ getBlacks(): int
+ getWhites(): int
}

mastermind.models.Result .down.> mastermind.models.Combination

class  mastermind.models.SecretCombination extends mastermind.models.Combination{
SecretCombination()
getResult(ProposedCombination): Result
}

mastermind.models.SecretCombination .down.> mastermind.models.Result
mastermind.models.SecretCombination .down.> mastermind.models.ProposedCombination
mastermind.models.SecretCombination .down.> mastermind.models.Color

abstract class mastermind.models.Combination{
- {static} WIDTH: int
# colors: List<Color>
# Combination()
+ {static} getWidth(): int
}
mastermind.models.Combination *-down-> mastermind.models.Color

class mastermind.models.State {
- stateValue: StateValue
+ State()
+ reset(): void
+ next(): void
+ getValueState():StateValue
}

mastermind.models.State *-down-> mastermind.models.StateValue

enum mastermind.models.StateValue {
+ {static} INITIAL: StateValue
+ {static} IN_GAME: StateValue
+ {static} RESUME: StateValue
+ {static} EXIT: StateValue
}

enum mastermind.models.Error{
+ {static} DUPLICATED: Error
+ {static} WRONG_CHARACTERS: Error
+ {static} WRONG_LENGTH: Error
}
....


=== Paquete _mastermind.controllers_


[plantuml,paqueteMastermindController,svg]

....

interface mastermind.controllers.ControllerVisitor {
+ visit(StartController startController): void
+ visit(PlayController playController): void
+ visit(ResumeController resumeController): void
}

mastermind.controllers.ControllerVisitor .down.> mastermind.controllers.StartController
mastermind.controllers.ControllerVisitor .down.> mastermind.controllers.PlayController
mastermind.controllers.ControllerVisitor .down.> mastermind.controllers.ResumeController

class mastermind.controllers.Logic {
- final state: State
- final controllers: Map<StateValue, UseCaseController>
+ Logic()
+ getController(): UseCaseController
}

mastermind.controllers.Logic *-up-> mastermind.models.State
mastermind.controllers.Logic *-up-> mastermind.models.StateValue
mastermind.controllers.Logic *-down-> mastermind.controllers.UseCaseController
mastermind.controllers.Logic .down.> mastermind.models.Game

abstract class mastermind.controllers.UseCaseController {
# final game: Game
# final state: State
UseCaseController(Game game, State state)
+ next(): void
+ {abstract} accept(ControllerVisitor controllerVisitor): void
}

mastermind.controllers.UseCaseController *-up-> mastermind.models.Game
mastermind.controllers.UseCaseController *-up-> mastermind.models.State
mastermind.controllers.UseCaseController .down.> mastermind.controllers.ControllerVisitor

class mastermind.controllers.PlayController extends mastermind.controllers.UseCaseController {
+ PlayController(Game game, State state)
+ addProposedCombination(ProposedCombination proposedCombination): void
+ getAttempts(): int
+ getProposedCombination(int position): ProposedCombination
+ getResult(int position): Result
+ isWinner(): boolean
+ isLooser(): boolean
+ accept(ControllerVisitor controllerVisitor): void
}

mastermind.controllers.PlayController .up.> mastermind.controllers.ControllerVisitor
mastermind.controllers.PlayController .down.> mastermind.models.ProposedCombination
mastermind.controllers.PlayController .down.> mastermind.models.Result

class mastermind.controllers.ResumeController extends mastermind.controllers.UseCaseController {
+ ResumeController(Game game, State state)
+ resume(): void
+ accept(ControllerVisitor controllerVisitor): void
}

mastermind.controllers.ResumeController .up.> mastermind.controllers.ControllerVisitor

class mastermind.controllers.StartController extends mastermind.controllers.UseCaseController {
+StartController(Game game, State state)
+ accept(ControllerVisitor controllerVisitor): void
}

mastermind.controllers.StartController .up.> mastermind.controllers.ControllerVisitor
....

=== Paquete _mastermind.utils_

[plantuml,mastermindUtils2,svg]

....

class mastermind.utils.Console {
- final bufferedReader: BufferedReader
+ readString(String title): String
+ readString(): String
+ readInt(String title): int
+ readChar(String title): char
+ writeln(): void
+ write(String string): void
+ writeln(String string): void
+ write(char character): void
- writeError(String format): void
}

abstract class mastermind.utils.WithConsoleView{
# console: Console
# WithConsoleView()
}
mastermind.utils.WithConsoleView *-down-> mastermind.utils.Console

class  mastermind.utils.YesNoDialog extends mastermind.utils.WithConsoleView{
- {static} AFIRMATIVE: char
- {static} NEGATIVE: char
- {static} QUESTION: String
- {static} MESSAGE: String
+ read(String): boolean
+ read(): boolean
- {static} isAfirmative(char): boolean
- {static} isNegative(char): boolean
}
....

== Calidad del Software

=== Diseño

- [red line-through]#_**Método largo**: Método "play" de Mastermind,..._#

=== Rediseño

- _Nueva interfaz: Gráfica_
* [red line-through]#_**Clases Grandes**: los Modelos asumen la responsabilidad y crecen en líneas, métodos, atributos, ... con cada nueva tecnología_#
* [red line-through]#_**Alto acoplamiento**: los Modelos con cada nueva tecnología de interfaz (consola, gráficos, web, ...)_#
* [red line-through]#_**Baja cohesión**: cada Modelo está gestionando sus atributos y las tecnologías de interfaz_#
* [red line-through]#_**Open/Close**: hay que modificar los modelos que estaban funcionando previamente para escoger una tecnología de vista u otra (if's anidados)_#

- _Nuevas funcionalidades: undo/redo, demo, estadísiticas,..._
* [red]#_**Clases Grandes**: los Modelos asumen la responsabilidad y crecen en líneas, métodos, atributos, ... con las nuevas funcionalidades_#
* [red]#_**Open/Close**: hay que modificar los modelos que estaban funcionando previamente para incorporar nuevas funcionalidades_#

== Vista de Desarrollo/Implementación

[plantuml,diagramaImplementacion,svg]
....

package "  "  as mastermind {
}
package "  "  as mastermind.controllers {
}
package "  "  as mastermind.models {
}
package "  "  as mastermind.views {
}
package "  "  as mastermind.views.console {
}
package "  "  as mastermind.views.graphics {
}
package "  "  as mastermind.utils {
}
package "  "  as java.io {
}
package "  "  as java.util {
}

[mastermind.jar] as jar

jar *--> mastermind
jar *--> mastermind.controllers
jar *--> mastermind.models
jar *--> mastermind.views
mastermind.views *--> mastermind.views.console
mastermind.views *--> mastermind.views.graphics
jar *--> mastermind.utils
jar *--> java.io
jar *--> java.util
....


== Vista de Despliegue/Física

[plantuml,diagramaDespliegue,svg]
....

node node #DDDDDD [
<b>Personal Computer</b>
----
memory : xxx Mb
cpu : xxx GHz
]

[ mastermind.jar ] as component

node *--> component
....

== Vista de Procesos

- No hay concurrencia





