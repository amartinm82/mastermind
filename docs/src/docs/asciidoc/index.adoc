= Master Mind. Solución 16.1. *mvp.pv*
Álvaro Martín Martín <amartinm82@gmail.com>
:toc-title: Índice
:toc: left

:idprefix:
:idseparator: -
:imagesdir: images

== Requisitos 1. *Básica*

[cols="50,50"]
|===

a|
- link:https://en.wikipedia.org/wiki/Mastermind_(board_game)[*Wiki*] - link:https://www.youtube.com/watch?v=2-hTeg2M6GQ[*Youtube*]
* _Funcionalidad: **Básica**_
* _Interfaz: **Texto**_
* _Distribución: **Standalone**_
* _Persistencia: **No**_

a|

image::Dibujo.jpg[]

|===


== Vista de Lógica/Diseño

- Arquitectura Documento/Vista mediante *Patrón de Vista Pasiva*

=== Arquitectura 

[plantuml,version2Arquitectura,svg]
....

package mastermind #DDDDDD { } 
mastermind .down.> mastermind.controllers

package mastermind.controllers #DDDDDD {
    package mastermind.controllers.console {}
    package mastermind.controllers.graphics {}
}
mastermind.controllers .down.> mastermind.models
mastermind.controllers .down.> mastermind.views

package mastermind.models #DDDDDD { } 
package java.util{ }
mastermind.models .down.> java.util

package mastermind.utils #DDDDDD { } 
package java.io{ }
mastermind.utils .down.> java.io

package mastermind.views #DDDDDD {
    package mastermind.views.console {}
    package mastermind.views.graphics {}
}
mastermind.views.console .down.> mastermind.utils

....

=== Paquete _mastermind_ 

[plantuml,version2Mastermind,svg]

....

abstract class mastermind.Mastermind [[Mastermind.html]] {
    #logic: Logic
    #play(): void
    {abstract} #createLogic(): Logic
}

class mastermind.ConsoleMastermind [[ConsoleMastermind.html]] {
    #createLogic(): Logic
    {static} +main(String[]): void
}

class mastermind.GraphicsMastermind [[GraphicsMastermind.html]] {
    #createLogic(): Logic
    {static} +main(String[]): void
}

mastermind.Mastermind *--> mastermind.controllers.Logic

mastermind.Mastermind ..> mastermind.controllers.UseCaseController

mastermind.Mastermind <|-- mastermind.ConsoleMastermind

mastermind.Mastermind <|-- mastermind.GraphicsMastermind


abstract class mastermind.controllers.Logic [[Logic.html]] {
+getController(): UseCaseController
{abstract} +createStartController(Game, State): StartController
{abstract} +createPlayController(Game, State): PlayController
{abstract} +createResumeController(Game, State): ResumeController
}

abstract class mastermind.controllers.UseCaseController [[UseCaseController.html]] {
    #game: Game
    #state: State
    #view: View
    +next(): void
    {abstract} +createView(): View
    {abstract} +execute(): void
}

....

=== Paquete _mastermind.views.graphics_

[plantuml,mastermindViewsGraphics,svg]

....

interface mastermind.views.View [[View.html]] {
    {abstract} +interact(Map<String, Object>): Map<String, Object>
}

class mastermind.views.graphics.ResumeView [[ResumeView.html]] {
    {static} +NEW_GAME: String
    +interact(Map<String, Object>): Map<String, Object>
}

class mastermind.views.graphics.StartView [[StartView.html]] {
    +interact(Map<String, Object>): Map<String, Object>
}

class mastermind.views.graphics.ProposedCombinationView [[ProposedCombinationView.html]] {
    {static} +PROPOSED_COMBINATION: String
    {static} +write(ProposedCombination): void
    +interact(Map<String, Object>): Map<String, Object>
}

class mastermind.views.graphics.PlayView [[PlayView.html]] {
    {static} +RESULTS: String
    +interact(Map<String, Object>): Map<String, Object>
}

abstract class utils.WithConsoleView [[WithConsoleView.html]] {
    #console: Console
}
utils.WithConsoleView <|-- mastermind.views.graphics.ResumeView

interface mastermind.views.View {
    {abstract} +interact(Map<String, Object>): Map<String, Object>
}
mastermind.views.View <|.. mastermind.views.graphics.ResumeView

utils.WithConsoleView <|-- mastermind.views.graphics.ResumeView

utils.WithConsoleView <|-- mastermind.views.graphics.StartView

mastermind.views.View <|.. mastermind.views.graphics.StartView

utils.WithConsoleView <|-- mastermind.views.graphics.ProposedCombinationView

mastermind.views.View <|.. mastermind.views.graphics.ProposedCombinationView

utils.WithConsoleView <|-- mastermind.views.graphics.PlayView

mastermind.views.View <|.. mastermind.views.graphics.PlayView

....

=== Paquete _mastermind.views.console_

[plantuml,mastermindViewsConsole,svg]

=== Paquete _mastermind.views.console_

[plantuml,mastermindViews,svg]

....
abstract class utils.WithConsoleView [[WithConsoleView.html]] {
    #console: Console
}

class utils.YesNoDialog [[YesNoDialog.html]] {
    +read(String): boolean
    +read(): boolean
}

enum mastermind.models.Color{
+ {static} RED: Color
+ {static} BLUE: Color
+ {static} YELLOW: Color
+ {static} GREEN: Color
+ {static} ORANGE: Color
+ {static} PURPLE: Color
{static} length(): int
}

class mastermind.views.console.ColorView extends utils.WithConsoleView {
    - {static} final INITIALS: char[]
    - final color: Color
    ColorView(Color color)
    {static} allInitials(): String
    {static} getInstance(char character): Color
    write(): void
}

mastermind.views.console.ColorView *-down-> mastermind.models.Color

class mastermind.views.console.ErrorView extends utils.WithConsoleView{
    - {static} final MESSAGES: String[]
    - final error: Error
    ErrorView(Error error)
    writeln(): void
}

enum mastermind.models.Error{
+ {static} DUPLICATED: Error
+ {static} WRONG_CHARACTERS: Error
+ {static} WRONG_LENGTH: Error
}

mastermind.views.console.ErrorView *-down-> mastermind.models.Error

enum mastermind.views.console.MessageView{
    + {static} ATTEMPTS: MessageView
    + {static} RESUME: MessageView
    + {static} RESULT: MessageView
    + {static} PROPOSED_COMBINATION: MessageView
    + {static} TITLE: MessageView
    + {static} WINNER: MessageView
    + {static} LOOSER: MessageView

    - final message: String
    - final console: Console

    - MessageView(String message)
    write(): void
    writeln(): void
    writeln(int attempts): void
    writeln(int blacks, int whites): void
}

class mastermind.views.console.PlayView [[PlayView.html]] {
    {static} +ATTEMPTS: String
    {static} +PROPOSED_COMBINATIONS: String
    {static} +RESULTS: String
    {static} +IS_WINNER: String
    {static} +IS_LOOSER: String
    +interact(Map<String, Object>): Map<String, Object>
}

utils.WithConsoleView <|-- mastermind.views.console.PlayView

mastermind.views.View <|.. mastermind.views.console.PlayView

mastermind.views.console.PlayView *--> mastermind.views.console.SecretCombinationView
mastermind.views.console.PlayView ..> mastermind.views.console.MessageView
mastermind.views.console.PlayView ..> mastermind.views.console.ProposedCombinationView
mastermind.views.console.PlayView ..> mastermind.views.console.ResultView
mastermind.views.console.PlayView ..> mastermind.models.ProposedCombination
mastermind.views.console.PlayView ..> mastermind.models.Result

class mastermind.views.console.ProposedCombinationView [[ProposedCombinationView.html]] {
    {static} +PROPOSED_COMBINATION: String
    {static} +write(ProposedCombination): void
    +interact(Map<String, Object>): Map<String, Object>
}

utils.WithConsoleView <|-- mastermind.views.console.ProposedCombinationView
mastermind.views.View <|.. mastermind.views.console.ProposedCombinationView
mastermind.views.console.ProposedCombinationView ..> mastermind.models.ProposedCombination
mastermind.views.console.ProposedCombinationView ..> mastermind.models.Error
mastermind.views.console.ProposedCombinationView ..> mastermind.views.console.MessageView
mastermind.views.console.ProposedCombinationView ..> mastermind.views.console.ColorView

class mastermind.views.console.ResultView extends utils.WithConsoleView {
- final result: Result
ResultView(Result result)
writeln(): void
}

mastermind.views.console.ResultView *-down-> mastermind.models.Result
mastermind.views.console.ResultView ..> mastermind.views.console.MessageView

class mastermind.views.console.ResumeView [[ResumeView.html]] {
    {static} +NEW_GAME: String
    +interact(Map<String, Object>): Map<String, Object>
}

mastermind.views.console.ResumeView ..> utils.YesNoDialog
mastermind.views.console.ResumeView ..> mastermind.views.console.MessageView
mastermind.views.View <|.. mastermind.views.console.ResumeView

class mastermind.views.console.SecretCombinationView extends utils.WithConsoleView {
SecretCombinationView()
writeln(): void
}

mastermind.views.console.SecretCombinationView .down.> mastermind.models.SecretCombination
mastermind.views.console.SecretCombinationView .up.> mastermind.views.console.MessageView

class mastermind.views.console.StartView [[StartView.html]] {
    +interact(Map<String, Object>): Map<String, Object>
}

mastermind.views.View <|.. mastermind.views.console.StartView
mastermind.views.console.StartView *--> mastermind.views.console.MessageView
mastermind.views.console.StartView *--> mastermind.views.console.SecretCombinationView
....


=== Paquete _mastermind.models_ 


[plantuml,paqueteMastermindModel,svg]

....

enum mastermind.models.Color{
+ {static} RED: Color
+ {static} BLUE: Color
+ {static} YELLOW: Color
+ {static} GREEN: Color
+ {static} ORANGE: Color
+ {static} PURPLE: Color
{static} length(): int
}

class  mastermind.models.Game{
- {static} final MAX_LONG: int
- secretCombination: SecretCombination
- proposedCombinations: List<ProposedCombination>
- results: List<Result>
- attempts: int
+ Game()
+ getProposedCombinations(): List<ProposedCombination>
+ getResults(): List<Result>
+ getAttempts(): int
+ clear(): void
+ addProposedCombination(ProposedCombination proposedCombination): void
+ isLooser(): boolean
+ isWinner(): boolean
}
mastermind.models.Game *-down-> mastermind.models.SecretCombination
mastermind.models.Game *-down-> mastermind.models.Result
mastermind.models.Game *-down-> mastermind.models.ProposedCombination

class  mastermind.models.ProposedCombination extends mastermind.models.Combination {
contains(Color color, int position): boolean
contains(Color color): boolean
+ getColors(): List<Color>
}

mastermind.models.ProposedCombination .down.> mastermind.models.Color

class mastermind.models.Result{
- blacks: int
- whites: int
Result(int, int)
isWinner(): boolean
+ getBlacks(): int
+ getWhites(): int
}

mastermind.models.Result .down.> mastermind.models.Combination

class  mastermind.models.SecretCombination extends mastermind.models.Combination{
SecretCombination()
getResult(ProposedCombination): Result
}

mastermind.models.SecretCombination .down.> mastermind.models.Result
mastermind.models.SecretCombination .down.> mastermind.models.ProposedCombination
mastermind.models.SecretCombination .down.> mastermind.models.Color

abstract class mastermind.models.Combination{
- {static} WIDTH: int
# colors: List<Color>
# Combination()
+ {static} getWidth(): int
}
mastermind.models.Combination *-down-> mastermind.models.Color

class mastermind.models.State {
- stateValue: StateValue
+ State()
+ reset(): void
+ next(): void
+ getValueState():StateValue
}

mastermind.models.State *-down-> mastermind.models.StateValue

enum mastermind.models.StateValue {
+ {static} INITIAL: StateValue
+ {static} IN_GAME: StateValue
+ {static} RESUME: StateValue
+ {static} EXIT: StateValue
}

enum mastermind.models.Error{
+ {static} DUPLICATED: Error
+ {static} WRONG_CHARACTERS: Error
+ {static} WRONG_LENGTH: Error
}
....


=== Paquete _mastermind.controllers_


[plantuml,paqueteMastermindController,svg]

....
abstract class mastermind.controllers.AddProposalController [[AddProposalController.html]] {
    +AddProposalController(Game, State)
    +execute(): void
}

mastermind.controllers.UseCaseController <|-- mastermind.controllers.AddProposalController
mastermind.controllers.AddProposalController ..> mastermind.models.ProposedCombination

abstract class mastermind.controllers.Logic [[Logic.html]] {
    {abstract} +createStartController(Game, State): StartController
    {abstract} +createPlayController(Game, State): PlayController
    {abstract} +createResumeController(Game, State): ResumeController
}

mastermind.controllers.Logic *-up-> mastermind.models.State
mastermind.controllers.Logic *-up-> mastermind.models.StateValue
mastermind.controllers.Logic *-down-> mastermind.controllers.UseCaseController
mastermind.controllers.Logic *-down-> mastermind.controllers.StartController
mastermind.controllers.Logic *-down-> mastermind.controllers.PlayController
mastermind.controllers.Logic *-down-> mastermind.controllers.ResumeController
mastermind.controllers.Logic .down.> mastermind.models.Game

abstract class mastermind.controllers.PlayController [[PlayController.html]] {
    +PlayController(Game, State)
    +execute(): void
    {abstract} +createAddProposalController(Game, State): AddProposalController
}

mastermind.controllers.UseCaseController <|-- mastermind.controllers.PlayController
mastermind.controllers.PlayController *-> mastermind.controllers.AddProposalController

abstract class mastermind.controllers.ResumeController [[ResumeController.html]] {
    +ResumeController(Game, State)
    +execute(): void
}

mastermind.controllers.UseCaseController <|-- mastermind.controllers.ResumeController

abstract class mastermind.controllers.StartController [[StartController.html]] {
    +StartController(Game, State)
    +execute(): void
}

mastermind.controllers.UseCaseController <|-- mastermind.controllers.StartController

abstract class mastermind.controllers.UseCaseController [[UseCaseController.html]] {
    #game: Game
    #state: State
    #view: View
    +next(): void
    {abstract} +createView(): View
    {abstract} +execute(): void
}



....

=== Paquete _mastermind.controllers_


[plantuml,paqueteMastermindControllerConsole,svg]

....
class amartinm.mastermind.controllers.console.AddProposalControllerImplementation [[AddProposalControllerImplementation.html]] {
    +AddProposalControllerImplementation(Game, State)
    +createView(): View
}

abstract class amartinm.mastermind.controllers.AddProposalController
amartinm.mastermind.controllers.AddProposalController <|-- amartinm.mastermind.controllers.console.AddProposalControllerImplementation
amartinm.mastermind.controllers.console.AddProposalControllerImplementation --> amartinm.mastermind.views.console.ProposedCombinationView


class amartinm.mastermind.controllers.console.LogicConsole [[LogicConsole.html]] {
    +createStartController(Game, State): StartController
    +createPlayController(Game, State): PlayController
    +createResumeController(Game, State): ResumeController
}

amartinm.mastermind.controllers.Logic <|-- amartinm.mastermind.controllers.console.LogicConsole
mastermind.controllers.console.LogicConsole --> amartinm.mastermind.controllers.console.StartControllerImplementation

class amartinm.mastermind.controllers.console.ResumeControllerImplementation [[ResumeControllerImplementation.html]] {
    +ResumeControllerImplementation(Game, State)
    +createView(): View
}

class amartinm.mastermind.controllers.console.PlayControllerImplementation [[PlayControllerImplementation.html]] {
    +PlayControllerImplementation(Game, State)
    +createView(): View
    +createAddProposalController(Game, State): AddProposalController
}

class amartinm.mastermind.controllers.console.StartControllerImplementation [[StartControllerImplementation.html]] {
    +StartControllerImplementation(Game, State)
    +createView(): View
}



abstract class amartinm.mastermind.controllers.Logic {
    {abstract} +createStartController(Game, State): StartController
    {abstract} +createPlayController(Game, State): PlayController
    {abstract} +createResumeController(Game, State): ResumeController
}

abstract class amartinm.mastermind.controllers.ResumeController
amartinm.mastermind.controllers.ResumeController <|-- amartinm.mastermind.controllers.console.ResumeControllerImplementation

abstract amartinm.mastermind.controllers.StartController
amartinm.mastermind.controllers.StartController <|-- amartinm.mastermind.controllers.console.StartControllerImplementation

abstract class amartinm.mastermind.controllers.console.amartinm.mastermind.controllers.PlayController {
    {abstract} +createAddProposalController(Game, State): amartinm.mastermind.controllers.console.AddProposalController
}
amartinm.mastermind.controllers.PlayController <|-- amartinm.mastermind.controllers.console.PlayControllerImplementation

....

=== Paquete _mastermind.utils_

[plantuml,mastermindUtils2,svg]

....

class mastermind.utils.Console {
- final bufferedReader: BufferedReader
+ readString(String title): String
+ readString(): String
+ readInt(String title): int
+ readChar(String title): char
+ writeln(): void
+ write(String string): void
+ writeln(String string): void
+ write(char character): void
- writeError(String format): void
}

abstract class mastermind.utils.WithConsoleView{
# console: Console
# WithConsoleView()
}
mastermind.utils.WithConsoleView *-down-> mastermind.utils.Console

class  mastermind.utils.YesNoDialog extends mastermind.utils.WithConsoleView{
- {static} AFIRMATIVE: char
- {static} NEGATIVE: char
- {static} QUESTION: String
- {static} MESSAGE: String
+ read(String): boolean
+ read(): boolean
- {static} isAfirmative(char): boolean
- {static} isNegative(char): boolean
}
....

== Calidad del Software

=== Diseño

- [red line-through]#_**Método largo**: Método "play" de Mastermind,..._#

=== Rediseño

- _Nueva interfaz: Gráfica_
* [red line-through]#_**Clases Grandes**: los Modelos asumen la responsabilidad y crecen en líneas, métodos, atributos, ... con cada nueva tecnología_#
* [red line-through]#_**Alto acoplamiento**: los Modelos con cada nueva tecnología de interfaz (consola, gráficos, web, ...)_#
* [red line-through]#_**Baja cohesión**: cada Modelo está gestionando sus atributos y las tecnologías de interfaz_#
* [red line-through]#_**Open/Close**: hay que modificar los modelos que estaban funcionando previamente para escoger una tecnología de vista u otra (if's anidados)_#

- _Nuevas funcionalidades: undo/redo, demo, estadísiticas,..._
* [red]#_**Clases Grandes**: los Modelos asumen la responsabilidad y crecen en líneas, métodos, atributos, ... con las nuevas funcionalidades_#
* [red]#_**Open/Close**: hay que modificar los modelos que estaban funcionando previamente para incorporar nuevas funcionalidades_#

== Vista de Desarrollo/Implementación

[plantuml,diagramaImplementacion,svg]
....

package "  "  as mastermind {
}
package "  "  as mastermind.controllers {
}
package "  "  as mastermind.models {
}
package "  "  as mastermind.views {
}
package "  "  as mastermind.views.console {
}
package "  "  as mastermind.views.graphics {
}
package "  "  as mastermind.utils {
}
package "  "  as java.io {
}
package "  "  as java.util {
}

[mastermind.jar] as jar

jar *--> mastermind
jar *--> mastermind.controllers
jar *--> mastermind.models
jar *--> mastermind.views
mastermind.views *--> mastermind.views.console
mastermind.views *--> mastermind.views.graphics
jar *--> mastermind.utils
jar *--> java.io
jar *--> java.util
....


== Vista de Despliegue/Física

[plantuml,diagramaDespliegue,svg]
....

node node #DDDDDD [
<b>Personal Computer</b>
----
memory : xxx Mb
cpu : xxx GHz
]

[ mastermind.jar ] as component

node *--> component
....

== Vista de Procesos

- No hay concurrencia





