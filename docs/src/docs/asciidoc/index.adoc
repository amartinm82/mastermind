= Master Mind. Solución 9.3. *mvp.pm.withComposite*
Álvaro Martín Martín <amartinm82@gmail.com>
:toc-title: Índice
:toc: left

:idprefix:
:idseparator: -
:imagesdir: images

== Requisitos 1. *Básica*

[cols="50,50"]
|===

a|
- link:https://en.wikipedia.org/wiki/Mastermind_(board_game)[*Wiki*] - link:https://www.youtube.com/watch?v=2-hTeg2M6GQ[*Youtube*]
* _Funcionalidad: **Básica**_
* _Interfaz: **Texto**_
* _Distribución: **Standalone**_
* _Persistencia: **No**_

a|

image::Dibujo.jpg[]

|===

== Vista de Lógica/Diseño

- Arquitectura Documento/Vista mediante *Patrón de Vista Separada*

=== Arquitectura 

[plantuml,version2Arquitectura,svg]
....

package mastermind #DDDDDD { } 
mastermind .down.> mastermind.controllers
mastermind .down.> mastermind.models
mastermind .down.> mastermind.views

package mastermind.controllers #DDDDDD { }
mastermind.controllers .down.> mastermind.models

package mastermind.models #DDDDDD { } 
package java.util{ }
mastermind.models .down.> java.util

package mastermind.utils #DDDDDD { } 
package java.io{ }
mastermind.utils .down.> java.io

package mastermind.views #DDDDDD {
    package mastermind.views.console {}
    package mastermind.views.graphics {}
}
mastermind.views .down.> mastermind.controllers
mastermind.views.console .down.> mastermind.utils

....

=== Paquete _mastermind_ 

[plantuml,version2Mastermind,svg]
....

abstract class  mastermind.Mastermind{
- final logic: Logic
- final view: View
# Mastermind()
# {abstract} createView(): View
# play(): void
}

class mastermind.ConsoleMastermind extends mastermind.Mastermind{
# createView(): View
+ {static} main(String[] args): void
}

class mastermind.GraphicsMastermind extends mastermind.Mastermind{
# createView(): View
+ {static} main(String[] args): void
}

mastermind.Mastermind *-down-> mastermind.views.View
mastermind.Mastermind *-down-> mastermind.controllers.Logic
mastermind.Mastermind .down.> mastermind.controllers.AcceptorController

mastermind.GraphicsMastermind .down.> mastermind.views.graphics.View

mastermind.ConsoleMastermind .down.> mastermind.views.console.View

mastermind.views.console.View <|.down.> mastermind.controllers.ControllerVisitor
mastermind.views.View <|-down-> mastermind.views.console.View
mastermind.views.View <|-down-> mastermind.views.graphics.View
....

=== Paquete _mastermind.views_ 

[plantuml,mastermindViews,svg]
....


abstract class mastermind.views.View {
+ {abstract} interact(UseCaseController controller): void
}

mastermind.views.View .up.> mastermind.controllers.AcceptorController

class mastermind.views.graphics.View {
+ interact(UseCaseController controller): void
}

mastermind.views.View <|-left- mastermind.views.graphics.View
mastermind.views.graphics.View .left.> mastermind.controllers.AcceptorController

class mastermind.views.console.View{
- final startView: StartView
- final playView: PlayView
- final resumeView: ResumeView

+ View()
+ interact(UseCaseController controller): void
+ visit(StartController startController): void
+ visit(PlayController playController): void
+ visit(ResumeController resumeController): void
}
mastermind.views.View <|-up- mastermind.views.console.View
mastermind.controllers.ControllerVisitor <|.up. mastermind.views.console.View
mastermind.views.console.View *-down-> mastermind.views.console.StartView
mastermind.views.console.View *-down-> mastermind.views.console.PlayView
mastermind.views.console.View *-down-> mastermind.views.console.ResumeView
mastermind.views.console.View .up.> mastermind.controllers.AcceptorController

enum mastermind.views.console.MessageView{
+ {static} ATTEMPTS: MessageView
+ {static} RESUME: MessageView
+ {static} RESULT: MessageView
+ {static} PROPOSED_COMBINATION: MessageView
+ {static} TITLE: MessageView
+ {static} WINNER: MessageView
+ {static} LOOSER: MessageView
+ {static} ACTION_COMMAND
+ {static} UNDO_COMMAND
+ {static} REDO_COMMAND

- final message: String
- final console: Console

- MessageView(String message)
+ getMessage(): String
write(): void
writeln(): void
writeln(int attempts): void
writeln(int blacks, int whites): void
}

mastermind.views.console.MessageView *-down-> utils.Console

class mastermind.views.console.StartView {
# interact(StartController startController): void
}

mastermind.views.console.StartView .down.> mastermind.controllers.StartController
mastermind.views.console.StartView .up.> mastermind.views.console.MessageView
mastermind.views.console.StartView .down.> mastermind.views.console.SecretCombinationView

class mastermind.views.console.SecretCombinationView {
SecretCombinationView()
writeln(): void
}

mastermind.views.console.SecretCombinationView .down.> mastermind.models.SecretCombination
mastermind.views.console.SecretCombinationView .up.> mastermind.views.console.MessageView
mastermind.views.console.SecretCombinationView .down.> utils.Console

class mastermind.views.console.ResumeView {
interact(ResumeController resumeController): void
}

mastermind.views.console.ResumeView .down.> mastermind.controllers.ResumeController
mastermind.views.console.ResumeView .down.> utils.YesNoDialog
mastermind.views.console.ResumeView .up.> mastermind.views.console.MessageView

class mastermind.views.console.ResultView {
- final result: Result
ResultView(Result result)
writeln(): void
}

mastermind.views.console.ResultView *-down-> mastermind.models.Result
mastermind.views.console.ResultView .up.> mastermind.views.console.MessageView

class mastermind.views.console.ProposedCombinationView {
- final proposedCombination: ProposedCombination
ProposedCombinationView(ProposedCombination proposedCombination)
write(): void
read(): void
}

mastermind.views.console.ProposedCombinationView *-down-> mastermind.models.ProposedCombination
mastermind.views.console.ProposedCombinationView .down.> mastermind.models.Color
mastermind.views.console.ProposedCombinationView .down.> mastermind.views.console.ColorView
mastermind.views.console.ProposedCombinationView .down.> mastermind.models.Error
mastermind.views.console.ProposedCombinationView .up.> mastermind.views.console.MessageView
mastermind.views.console.ProposedCombinationView .down.> mastermind.views.console.ErrorView
mastermind.views.console.ProposedCombinationView .down.> utils.Console

class mastermind.views.console.PlayView {
PlayView()
interact(PlayController playController): void
}

mastermind.views.console.PlayView .down.> mastermind.controllers.PlayController
mastermind.views.console.PlayView .down.> mastermind.views.console.PlayMenu


class mastermind.views.console.ErrorView {
- {static} final MESSAGES: String[]
- final error: Error
ErrorView(Error error)
writeln(): void
}

mastermind.views.console.ErrorView *-down-> mastermind.models.Error
mastermind.views.console.ErrorView .down.> utils.Console

class mastermind.views.console.ColorView {
- {static} final INITIALS: char[]
- final color: Color
ColorView(Color color)
{static} allInitials(): String
{static} getInstance(char character): Color
write(): void
}

mastermind.views.console.ColorView *-down-> mastermind.models.Color
mastermind.views.console.ColorView .down.> utils.Console

abstract class mastermind.views.console.Command extends utils.Command {
# final playController: PlayController
# Command(String title, PlayController playController)
}

mastermind.views.console.Command *-down-> mastermind.controllers.PlayController


class mastermind.views.console.GameView {
- final playController: PlayController
- final secretCombinationView: SecretCombinationView

GameView(PlayController playController)
+ write(): void
}

mastermind.views.console.GameView *-down-> mastermind.views.console.SecretCombinationView
mastermind.views.console.GameView *-down-> mastermind.controllers.PlayController
mastermind.views.console.GameView .down.> utils.Console
mastermind.views.console.GameView .down.> mastermind.views.console.MessageView
mastermind.views.console.GameView .down.> mastermind.views.console.ProposedCombinationView
mastermind.views.console.GameView .down.> mastermind.views.console.ResultView

class mastermind.views.console.PlayMenu extends utils.Menu {
PlayMenu(PlayController playController)
}

mastermind.views.console.PlayMenu .down.> mastermind.controllers.PlayController
mastermind.views.console.PlayMenu .down.> mastermind.views.console.ProposalCommand
mastermind.views.console.PlayMenu .down.> mastermind.views.console.UndoCommand
mastermind.views.console.PlayMenu .down.> mastermind.views.console.RedoCommand

class mastermind.views.console.ProposalCommand extends mastermind.views.console.Command {
ProposalCommand(PlayController playController)
# execute(): void
# isActive(): boolean
}

mastermind.views.console.ProposalCommand .down.> mastermind.controllers.PlayController
mastermind.views.console.ProposalCommand .down.> mastermind.views.console.MessageView
mastermind.views.console.ProposalCommand .down.> mastermind.models.ProposedCombination
mastermind.views.console.ProposalCommand .down.> mastermind.views.console.ProposedCombinationView
mastermind.views.console.ProposalCommand .down.> mastermind.views.console.GameView

class mastermind.views.console.UndoCommand extends mastermind.views.console.Command {
UndoCommand(PlayController playController)
# execute(): void
# isActive(): boolean
}

mastermind.views.console.UndoCommand .down.> mastermind.controllers.PlayController
mastermind.views.console.UndoCommand .down.> mastermind.views.console.MessageView
mastermind.views.console.UndoCommand .down.> mastermind.views.console.GameView

class mastermind.views.console.RedoCommand extends mastermind.views.console.Command {
RedoCommand(PlayController playController)
# execute(): void
# isActive(): boolean
}

mastermind.views.console.RedoCommand .down.> mastermind.controllers.PlayController
mastermind.views.console.RedoCommand .down.> mastermind.views.console.MessageView
mastermind.views.console.RedoCommand .down.> mastermind.views.console.GameView
....

=== Paquete _mastermind.models_ 

[plantuml,paqueteMastermindModel,svg]
....

enum mastermind.models.Color{
+ {static} RED: Color
+ {static} BLUE: Color
+ {static} YELLOW: Color
+ {static} GREEN: Color
+ {static} ORANGE: Color
+ {static} PURPLE: Color
{static} length(): int
}

class  mastermind.models.Game{
- {static} final MAX_LONG: int
- secretCombination: SecretCombination
- proposedCombinations: List<ProposedCombination>
- results: List<Result>
- attempts: int
+ Game()
+ clear(): void
+ addProposedCombination(ProposedCombination proposedCombination): void
+ isLooser(): boolean
+ isWinner(): boolean
+ getAttempts(): int
+ getProposedCombination(int position): ProposedCombination
+ getResult(int position): Result
+ createMemento(): GameMemento
+ set(GameMemento memento): void
}
mastermind.models.Game *-down-> mastermind.models.SecretCombination
mastermind.models.Game *-down-> mastermind.models.Result
mastermind.models.Game *-down-> mastermind.models.ProposedCombination
mastermind.models.Game .down.> mastermind.models.GameMemento

class  mastermind.models.ProposedCombination extends mastermind.models.Combination {
contains(Color color, int position): boolean
contains(Color color): boolean
+ getColors(): List<Color>
}

mastermind.models.ProposedCombination .down.> mastermind.models.Color

class mastermind.models.Result{
- blacks: int
- whites: int
Result(int, int)
isWinner(): boolean
+ getBlacks(): int
+ getWhites(): int
}

mastermind.models.Result .down.> mastermind.models.Combination

class  mastermind.models.SecretCombination extends mastermind.models.Combination{
SecretCombination()
getResult(ProposedCombination): Result
}

mastermind.models.SecretCombination .down.> mastermind.models.Result
mastermind.models.SecretCombination .down.> mastermind.models.ProposedCombination
mastermind.models.SecretCombination .down.> mastermind.models.Color

abstract class mastermind.models.Combination{
- {static} WIDTH: int
# colors: List<Color>
# Combination()
+ {static} getWidth(): int
}
mastermind.models.Combination *-down-> mastermind.models.Color

class mastermind.models.State {
- stateValue: StateValue
+ State()
+ reset(): void
+ next(): void
+ getValueState():StateValue
}

mastermind.models.State *-down-> mastermind.models.StateValue

enum mastermind.models.StateValue {
+ {static} INITIAL: StateValue
+ {static} IN_GAME: StateValue
+ {static} RESUME: StateValue
+ {static} EXIT: StateValue
}

enum mastermind.models.Error{
+ {static} DUPLICATED: Error
+ {static} WRONG_CHARACTERS: Error
+ {static} WRONG_LENGTH: Error
}

class mastermind.models.GameMemento {

- final proposedCombinations: List<ProposedCombination>
- final results: List<Result>
- final attempts: int

+ GameMemento(List<ProposedCombination> proposedCombinations, List<Result> results, int attempts)
+ getProposedCombinations(): List<ProposedCombination>
+ getResults(): List<Result>
+ getAttempts(): int
}

mastermind.models.GameMemento .down.> mastermind.models.ProposedCombination
mastermind.models.GameMemento .down.> mastermind.models.Result

class mastermind.models.GameRegistry {

- mementoList: List<GameMemento>
- final game: Game
- firstPrevious: int

GameRegistry(Game game)
reset(): void
registry(): void
undo(): void
redo(): void
undoable(): boolean
redoable(): boolean
}

mastermind.models.GameRegistry *-down-> mastermind.models.GameMemento
mastermind.models.GameRegistry *-down-> mastermind.models.Game

class mastermind.models.Session {

- final state: State
- final game: Game
- final registry: GameRegistry

+ Session()
+ next(): void
+ getValueState(): StateValue
+ undoable(): boolean
+ redoable(): boolean
+ undo(): void
+ redo(): void
+ addProposedCombination(ProposedCombination proposedCombination): void
+ getAttempts(): int
+ getProposedCombination(int position): ProposedCombination
+ getResult(int position): Result
+ isWinner(): boolean
+ isLooser(): boolean
+ reset(): void
}

mastermind.models.Session *-down-> mastermind.models.State
mastermind.models.Session *-down-> mastermind.models.Game
mastermind.models.Session *-down-> mastermind.models.GameRegistry
mastermind.models.Session .down.> mastermind.models.StateValue
mastermind.models.Session .down.> mastermind.models.ProposedCombination
mastermind.models.Session .down.> mastermind.models.Result
....

=== Paquete _mastermind.controllers_

[plantuml,paqueteMastermindController,svg]
....

interface mastermind.controllers.ControllerVisitor {
+ visit(StartController startController): void
+ visit(PlayController playController): void
+ visit(ResumeController resumeController): void
}

mastermind.controllers.ControllerVisitor .down.> mastermind.controllers.StartController
mastermind.controllers.ControllerVisitor .down.> mastermind.controllers.PlayController
mastermind.controllers.ControllerVisitor .down.> mastermind.controllers.ResumeController

class mastermind.controllers.Logic {
- final session: Session
- final controllers: Map<StateValue, AcceptorController>
+ Logic()
+ getController(): UseCaseController
}

mastermind.controllers.Logic *-up-> mastermind.models.Session
mastermind.controllers.Logic *-up-> mastermind.models.StateValue
mastermind.controllers.Logic *-down-> mastermind.controllers.AcceptorController

abstract class mastermind.controllers.UseCaseController {
# final session: Session
# final state: State
UseCaseController(Session session)
+ next(): void
}

mastermind.controllers.UseCaseController *-up-> mastermind.models.Session
mastermind.controllers.UseCaseController .down.> mastermind.controllers.ControllerVisitor

class mastermind.controllers.PlayController extends mastermind.controllers.UseCaseController implements mastermind.controllers.AcceptorController{
- final proposalController: ProposalController
- final undoController: UndoController
- final redoController: RedoController

+ PlayController(Session)
+ addProposedCombination(ProposedCombination proposedCombination): void
+ getAttempts(): int
+ getProposedCombination(int position): ProposedCombination
+ getResult(int position): Result
+ isWinner(): boolean
+ isLooser(): boolean
+ undo(): void
+ undoable(): boolean
+ redo(): void
+ redoable(): boolean
+ accept(ControllerVisitor controllerVisitor): void
}

mastermind.controllers.PlayController .up.> mastermind.controllers.ControllerVisitor
mastermind.controllers.PlayController .down.> mastermind.models.ProposedCombination
mastermind.controllers.PlayController .down.> mastermind.models.Result

class mastermind.controllers.ResumeController extends mastermind.controllers.UseCaseController implements mastermind.controllers.AcceptorController {
+ ResumeController(Session session)
+ resume(boolean isResumed): void
+ accept(ControllerVisitor controllerVisitor): void
}

mastermind.controllers.ResumeController .up.> mastermind.controllers.ControllerVisitor

class mastermind.controllers.StartController extends mastermind.controllers.UseCaseController implements mastermind.controllers.AcceptorController {
+StartController(Session session)
+ accept(ControllerVisitor controllerVisitor): void
}

mastermind.controllers.StartController .up.> mastermind.controllers.ControllerVisitor

interface mastermind.controllers.AcceptorController {
+ accept(ControllerVisitor controllerVisitor): void
+ next(): void
}

mastermind.controllers.AcceptorController .down.> mastermind.controllers.ControllerVisitor

class mastermind.controllers.ProposalController extends mastermind.controllers.UseCaseController {
+ ProposalController(Session session)
+ addProposedCombination(ProposedCombination proposedCombination): void
+ getAttempts(): int
+ getProposedCombination(int position): ProposedCombination
+ getResult(int position): Result
+ isWinner(): boolean
+ isLooser(): boolean
}

mastermind.controllers.ProposalController .down.> mastermind.models.ProposedCombination
mastermind.controllers.ProposalController .down.> mastermind.models.Result

class mastermind.controllers.RedoController extends mastermind.controllers.UseCaseController {
RedoController(Session session)
+ redo(): void
+ redoable(): boolean
}

class mastermind.controllers.UndoController extends mastermind.controllers.UseCaseController {
UndoController(Session session)
undo(): void
undoable(): boolean
}
....

=== Paquete _mastermind.utils_

[plantuml,mastermindUtils2,svg]
....

class utils.Console {
+ {static} console: Console

+ {static} instance(): Console
- final bufferedReader: BufferedReader
+ readString(String title): String
+ readString(): String
+ readInt(String title): int
+ readChar(String title): char
+ writeln(): void
+ write(String string): void
+ writeln(String string): void
+ write(char character): void
- writeError(String format): void
}

class  utils.YesNoDialog{
- {static} AFIRMATIVE: char
- {static} NEGATIVE: char
- {static} QUESTION: String
- {static} MESSAGE: String
+ read(String): boolean
+ read(): boolean
- {static} isAfirmative(char): boolean
- {static} isNegative(char): boolean
}

utils.YesNoDialog .down.> utils.Console

abstract class utils.Menu {

- {static} final OPTION: String
- final commandList: List<Command>

+ Menu()
+ execute(): void
# add(Command command): void
}

utils.Menu *-down-> utils.Command

abstract class utils.Command {
# final title: String
# Command(String title)
# {abstract} execute(): void
# {abstract} isActive(): boolean
getTitle():String
}

class utils.ClosedInterval {
- final min: int
- final max: int

+ ClosedInterval(int min, int max)
+ isIncluded(int value): boolean
+ toString(): String
}
....

== Calidad del Software

=== Diseño

- [red line-through]#_**Método largo**: Método "play" de Mastermind,..._#

=== Rediseño

- _Nueva interfaz: Gráfica_
* [red line-through]#_**Clases Grandes**: los Modelos asumen la responsabilidad y crecen en líneas, métodos, atributos, ... con cada nueva tecnología_#
* [red line-through]#_**Alto acoplamiento**: los Modelos con cada nueva tecnología de interfaz (consola, gráficos, web, ...)_#
* [red line-through]#_**Baja cohesión**: cada Modelo está gestionando sus atributos y las tecnologías de interfaz_#
* [red line-through]#_**Open/Close**: hay que modificar los modelos que estaban funcionando previamente para escoger una tecnología de vista u otra (if's anidados)_#

- _Nuevas funcionalidades: undo/redo, demo, estadísiticas,..._
* [red]#_**Clases Grandes**: los Modelos asumen la responsabilidad y crecen en líneas, métodos, atributos, ... con las nuevas funcionalidades_#
* [red]#_**Open/Close**: hay que modificar los modelos que estaban funcionando previamente para incorporar nuevas funcionalidades_#

== Vista de Desarrollo/Implementación

[plantuml,diagramaImplementacion,svg]
....

package "  "  as mastermind {
}
package "  "  as mastermind.controllers {
}
package "  "  as mastermind.models {
}
package "  "  as mastermind.views {
}
package "  "  as mastermind.views.console {
}
package "  "  as mastermind.views.graphics {
}
package "  "  as mastermind.utils {
}
package "  "  as java.io {
}
package "  "  as java.util {
}

[mastermind.jar] as jar

jar *--> mastermind
jar *--> mastermind.controllers
jar *--> mastermind.models
jar *--> mastermind.views
mastermind.views *--> mastermind.views.console
mastermind.views *--> mastermind.views.graphics
jar *--> mastermind.utils
jar *--> java.io
jar *--> java.util
....

== Vista de Despliegue/Física

[plantuml,diagramaDespliegue,svg]
....

node node #DDDDDD [
<b>Personal Computer</b>
----
memory : xxx Mb
cpu : xxx GHz
]

[ mastermind.jar ] as component

node *--> component
....

== Vista de Procesos

- No hay concurrencia





